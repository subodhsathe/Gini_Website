# Gini Website - New Project Structure Guide

## Overview

The project structure has been successfully reorganized. **The backend (Node.js/Express server) is now the root**, and the frontend (React application) is now contained in a `frontend/` subdirectory.

## New Directory Structure

```
gini/ (Backend Root)
├── frontend/                    # React Frontend Application
│   ├── src/                     # React source files
│   │   ├── components/          # React components
│   │   ├── App.js
│   │   ├── index.js
│   │   └── ...other React files
│   ├── public/                  # Static public assets
│   ├── build/                   # Production build (generated by npm run build)
│   ├── scripts/                 # Utility scripts
│   ├── package.json             # Frontend dependencies
│   └── package-lock.json
│
├── models/                      # MongoDB Mongoose models
│   ├── Question.js
│   └── Song.js
│
├── routes/                      # Express API routes
│   ├── authRoutes.js            # Authentication endpoints
│   ├── questionRoutes.js        # Questions API
│   └── songRoutes.js            # Songs API
│
├── server/                      # (Legacy - mostly empty, can be removed)
├── server.js                    # Main Express server file
├── db.js                        # MongoDB connection setup
├── package.json                 # Backend dependencies & scripts
├── render.yaml                  # Render.com deployment config
├── .env                         # Environment variables (local)
├── .env.example                 # Environment variables template
├── .gitignore
└── README.md
```

## Key Changes Made

### 1. **Backend at Root Level**
   - `server.js` moved from `server/server.js` to `server.js`
   - `db.js` moved from `server/db.js` to `db.js`
   - Database models (`models/`) now at root level
   - API routes (`routes/`) now at root level

### 2. **Frontend in Subdirectory**
   - Entire React app moved to `frontend/` folder
   - Frontend has its own `package.json` with React dependencies
   - Frontend build outputs to `frontend/build/`

### 3. **Updated Configuration Files**

   **Root `package.json` (Backend)**
   ```json
   {
     "name": "gini-backend",
     "scripts": {
       "start": "node server.js",
       "dev": "nodemon server.js",
       "client": "cd frontend && npm start",
       "dev-all": "concurrently \"npm run dev\" \"npm run client\"",
       "postinstall": "npm install --prefix frontend"
     }
   }
   ```

   **Frontend `package.json`**
   ```json
   {
     "name": "gini-frontend",
     "scripts": {
       "start": "react-scripts start",
       "build": "react-scripts build"
     }
   }
   ```

### 4. **Updated `server.js`**
   - Static file serving path changed from `path.join(__dirname, '..', 'build')` to `path.join(__dirname, 'frontend', 'build')`
   - This allows the server to serve the production React build in production mode

### 5. **Updated `render.yaml`**
   - Build command changed to run from root: `npm install`
   - Build command for frontend changed to: `cd frontend && npm run build`
   - Static publish path changed to: `./frontend/build`

## How to Run

### Development Mode

**Option 1: Run Backend and Frontend Separately**
```bash
# Terminal 1 - Backend
npm run dev

# Terminal 2 - Frontend
cd frontend && npm start
```

**Option 2: Run Both Concurrently (from root)**
```bash
npm run dev-all
```

### Production Mode

1. Build the frontend:
   ```bash
   cd frontend && npm run build
   ```

2. Start the backend server (serves frontend):
   ```bash
   NODE_ENV=production npm start
   ```

The backend will automatically serve the React frontend at `http://localhost:5000`

## Installation

1. Install backend dependencies:
   ```bash
   npm install
   ```
   This automatically installs frontend dependencies via the `postinstall` script.

2. Or manually install frontend dependencies:
   ```bash
   cd frontend && npm install
   ```

## Environment Variables

Both backend and frontend use the `.env` file at the root level:
- `MONGODB_URI` - MongoDB connection string
- `GINI_PASSWORD` - Admin login password
- `JWT_SECRET` - JWT signing secret
- `NODE_ENV` - Set to `production` for production deployments
- `PORT` - Server port (default: 5000)

## API Routes

All API routes are prefixed with `/api/`:
- `/api/auth/login` - Admin login
- `/api/questions/*` - Questions endpoints
- `/api/songs/*` - Songs endpoints
- `/api/health` - Health check endpoint

The React frontend makes requests to `http://localhost:5000` (via the `proxy` setting in frontend package.json during development).

## Deployment (Render.com)

The `render.yaml` is configured for Render.com deployment:
- **Web Service**: Deploys the Node.js backend
- **Static Site**: Deploys the React frontend from `frontend/build/`

To deploy:
1. Push changes to GitHub
2. Render will automatically build and deploy based on `render.yaml`

## Migration Notes

If you had any custom scripts or tools that referenced the old structure:
- Old path: `server/server.js` → New path: `server.js`
- Old path: `server/db.js` → New path: `db.js`
- Old path: `src/`, `public/`, `scripts/`, etc. → New path: `frontend/src/`, `frontend/public/`, `frontend/scripts/`
- Build output path: `build/` → New path: `frontend/build/`

## Troubleshooting

### Port conflicts
- Frontend tries ports 3000, 5000, 5001 in order
- Backend defaults to port 5000
- The dev script automatically handles this via concurrent process management

### Module not found errors
- Make sure both `npm install` and `cd frontend && npm install` have been run
- Clear `node_modules` and reinstall if needed: `rm -rf node_modules frontend/node_modules && npm install`

### Build issues
- Frontend build: `cd frontend && npm run build`
- Clear build cache: `rm -rf frontend/build && cd frontend && npm run build`

## Additional Resources

- Backend docs: See `server.js` comments
- Frontend: React app in `frontend/src/`
- Database models: Check `models/` directory
- API routes: See `routes/` directory
